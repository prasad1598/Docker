#STAGE 1 Build the Application
#Base image
FROM ubuntu:22.04 As builder

#set the working directory
WORKDIR /app

#update the packages repo and install neccessary dependenices
RUN apt update && apt install -y python3 python3-pip

#copy requirement.txt
COPY requirement.txt .

#install dependency
RUN pip3 install --no-cache-dir -r requirement.txt

#copy the application files
COPY app.py .
COPY templates/ ./templates
COPY static ./static

#STAGE 2 final stage
FROM python:3.9-slim

#set the working directory
WORKDIR /app

#copy the build application files from the builder stage
COPY --from=builder /app .

# Install Flaskfrom the builder stage
RUN pip3 install --no-cache-dir Flask

#expose the application port
EXPOSE 5000

#set environment variables
ENV FLASK_APP=app.py
ENV FLASK_RUN_HOST=0.0.0.0

#run the application
CMD ["python3", "-m", "flask", "run"]
